<!DOCTYPE html>
<html lang="en">

  <head>

    <!-- Meta Tag -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO -->
    <meta name="description" content="150 words">
    <meta name="author" content="Athul Antony">
    <meta name="url" content="www.techeos.com">
    <meta name="copyright" content="TechEOS">
    <meta name="robots" content="index,follow">
    <meta name="google-site-verification" content="pgEG4IJCNjR9R04Jk6UByLm--5HUOJtrojTlnb3CWk4" />
    <meta name="description" content="Write your firebase functions more securely using express middleware" itemprop="description">
    <meta property="og:tags" content="Android Development,Firebase,firebase console,
    firebase tutorial,firebase android,firebase functions,firebase database,firebase hosting,
    firebase analytics,firebase android tutorial,firebase admin,deploy a firebase app,firebase cloud functions,
    express js,middleware,server middleware,javascript,js,js tutorial,node js,node js tutorial,
    node js documentation,node js interview questions,node js express,node js framework,node js api,
    node js api tutorial">
    <meta name="keywords" content="Android Development,Firebase,firebase console,
    firebase tutorial,firebase android,firebase functions,firebase database,firebase hosting,
    firebase analytics,firebase android tutorial,firebase admin,deploy a firebase app,firebase cloud functions,
    express js,middleware,server middleware,javascript,js,js tutorial,node js,node js tutorial,
    node js documentation,node js interview questions,node js express,node js framework,node js api,
    node js api tutorial">
      <meta property="og:title" content="Firebase functions more securely using express middleware" />
      <meta property="og:description" content="Write your firebase functions more securely using express middleware">
      <meta property="og:type" content="article" />
      <meta property="og:image" content="www.techeos.com/images/blog/firebase_icon.png" />
      <meta property="twitter:image" content="www.techeos.com/images/blog/firebase_icon.png" />
      <meta property="og:site_name" content="TechEOS" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=yes">

    <title>Express middleware in Firebase cloud functions. | TechEOS</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="../images/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="144x144" type="image/x-icon" href="images/favicon/apple-touch-icon.png">

    <!-- All CSS Plugins -->
    <link rel="stylesheet" type="text/css" href="../css/plugin.css">

    <!-- Main CSS Stylesheet -->
    <link rel="stylesheet" type="text/css" href="../css/style.css">

    <!-- Google Web Fonts  -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:400,300,500,600,700">

    <!-- Syntax Highlighter  -->
    <link rel="stylesheet" type="text/css" href="../css/syntax/shCore.css">
    <link rel="stylesheet" type="text/css" href="../css/syntax/shThemeDefault.css">


    <!-- HTML5 shiv and Respond.js support IE8 or Older for HTML5 elements and media queries -->
    <!--[if lt IE 9]>
	   <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	   <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->




  </head>

 <body>

   <!--Google Analytics tracking code-->
   <script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-104487467-1', 'auto');
 ga('send', 'pageview');

 </script>

	 <!-- Preloader Start -->
     <div class="preloader">
	   <div class="rounder"></div>
      </div>
      <!-- Preloader End -->




    <div id="main">
        <div class="container">
            <div class="row">



                 <!-- About Me (Left Sidebar) Start -->
                  <div class="col-md-3">
                   <div class="about-fixed">

                     <div class="my-pic">
                        <img src="../images/pic/my-pic.png" alt="">
                        <a href="javascript:void(0)" class="collapsed" data-target="#menu" data-toggle="collapse"><i class="icon-menu menu"></i></a>
                         <div id="menu" class="collapse">
                           <ul class="menu-link">
                              <!-- <li><a href="about.html">About</a></li>
                               <li><a href="work.html">Work</a></li>
                               <li><a href="contact.html">Contact</a></li> -->
                                <li>About</li>
                               <li>Work</a></li>
                               <li>Contact</li>
                            </ul>
                         </div>
                        </div>



                      <div class="my-detail">

                        <div class="white-spacing">
                            <h1>Blog by Athul Antony</h1>
                            <span>Android Developer @ <a href="http://entri.me">Entri.Inc</a></span>

                        </div>

                       <ul class="social-icon">
                         <li><a href="https://www.facebook.com/athulantony" target="_blank" class="facebook"><i class="fa fa-facebook"></i></a></li>
                         <li><a href="https://twitter.com/athulantonynp" target="_blank" class="twitter"><i class="fa fa-twitter"></i></a></li>
                         <li><a href="https://www.linkedin.com/in/athul-antony-np-5242b4104/" target="_blank" class="linkedin"><i class="fa fa-linkedin"></i></a></li>
                         <li><a href="https://github.com/athulantonynp" target="_blank" class="github"><i class="fa fa-github"></i></a></li>
                        </ul>

                    </div>
                  </div>
                </div>
                <!-- About Me (Left Sidebar) End -->





                 <!-- Blog Post (Right Sidebar) Start -->
                 <div class="col-md-9">
                    <div class="col-md-12 page-body">
                    	<div class="row">


                            <div class="sub-title">
                           		<a href="../index.html" title="Go to Home Page"><h2>Back Home</h2></a>
                                <a href="#comment" class="smoth-scroll"><i class="icon-bubbles"></i></a>
                             </div>


                            <div class="col-md-12 content-page">
                              <div class="col-md-12 blog-post">


                                <!-- Post Headline Start -->
                                <div class="post-title">
                                    <h1>Express middleware in Firebase cloud functions.</h1>
                                   </div>
                                   <!-- Post Headline End -->


                                <!-- Post Detail Start -->
                                <div class="post-info">
                                    <span>April 21, 2018 / by <a href="#" target="_blank">Athul Antony</a></span>
                                   </div>
                                   <!-- Post Detail End -->
                                   <p>


                              Firebase cloud functions are the really helpful tool for mobile developers which lets them build Android/IOS apps without having the ease of maintaining a  server. Cloud functions have heavily relied on famous Javascript framework called Node.Js. It's event-driven and non-blocking I/O model architecture makes it more efficient and lightweight. You can easily trigger HTTP functions in firebase cloud functions using the node.js environment. 
                              </br> </br>
                                <img src="/images/blog/firebase.png"  width="800" height="350" alt="Firebase logo,Firebase cloud functions,firebase,android">
                              </br></br></br>
                              But for a production-ready application which has many HTTP function triggers, Maintaining identity of every HTTP requests is a pain point. For example, You may have to check the existence or state of the requesting user/account for all the HTTP requests. This is the plot where middlewares come into action for you. In simpler terms, Middleware is a framework/bridge which connects or performs some functions in between the client and server. A middleware can process the request and response as well as a server does. Express is a web application framework developed for Node.js which can be maintained as a middleware in Firebase cloud functions.This tutorial will help you to implement a simple middleware application using express web application framework. This is a beginner friendly tutorial to the Firebase Cloud Functions. First, Setup a firebase cloud function app on your machine as described in <a href="https://firebase.google.com/docs/functions/get-started" target="_blank"> this</a> official document.
                                   </p>
                                  
                                  <p>
                                    After setting up the Firebase CLI and Cloud functions project directory, You can head up to into the index.js file of functions folder in root directory of the project.As you go through the official document, You can see that setting up an endpoint and it's handler functions is easy to implement and push it to the original server. In below snippet, I have created a function which returns a sample JSON response to the requesting client. 
                                  </p>
                           
                                  <script src="https://gist.github.com/athulantonynp/d5c82bec44c2b5f6799b7acd40c16c4e.js"></script>

                                    </br>
                                   <p>
                                     Okay, Now everything works fine! I get a sample response in JSON format when the client Android app makes the call. Now What If I need to validate the client's identity before I make the response? The function should not trigger when a client is a trespasser. So I should call a validate function before the actual function right? This is where express.JS middleware comes into help for in your Firebase cloud function project. 
                                   </p>

                                 </br>
                                 <p>
                                   Okay, let's start implementing express js. Initially, as like an Android project, we have to add a dependency of express on our project. For that, head to root/functions/package.json file. This is where you should declare app dependencies. Add the dependency same as like this. 
                                 </p>
                                 <div class="margin-top-40 margin-bottom-40">
                                      <pre class="brush: js">

                                            "dependencies": {
                                                "firebase-admin": "~5.8.1",
                                                "express": "^4.15.2",
                                                "firebase-functions": "^0.8.1"
                                              }

                                    </pre>
                                  </div>
                                  <p>
                                    Or else, You can simply run the below command in your functions folder. 
                                  </p>

                                   <blockquote class="margin-top-40 margin-bottom-40">
                            <p> <b>yarn add express</b></p>
                          </blockquote>

                                  <p>
                                    We have completed our initial setups now let's get into the code. 
                                    In your index.js file initiate express instance below like this.
                                    
                                   </br> <b>const express = require('express');</b>  </br>

                                    And create the app instance ,

                                     </br> <b>const app = express();</b>
                                  </p>
                                    <p>
                                      Now here comes the magic! Create a function called validate() which is a constant with parameters of the request, response and next. next() simply allows the next route handler in line to handle the request.It passes control to the next matching route.
                                      After the client validation in middleware, next() will take the request to the actual function or else, It will throw error response to the user. You can implement your DB related queries for searching the user inside this function scope.

                                    </p>
                                    </br>
                                      <script src="https://gist.github.com/athulantonynp/fbf80dbd3822aa54ccd829e68b82d904.js"></script>
                                    </br>
                                     </br>

                                    <p>Now we have to make use of this middleware function with the app instance. So call 
                                      </br>
                                      <b> app.use(validateFirebaseRequest);<b> </br></p>

                                        <p>
                                          Now let's define our routed or actual endpoint. We can use any of <b> app.all(), app.get(), app.post(), app.delete() and app.put() </b>methods . All those GET,POST,DELETE,PUT annotations of retrofit  library call is recieved by these functions.
                                        </p>

                                        <script src="https://gist.github.com/athulantonynp/c50caf1abf13037223e388c0e354b9b0.js"></script>
                                        <p>
                                          Last but not least, We should make the request to Firebase CF to make use of our middleware in the project by adding the below line at the end of the index.js file.

                                        </p>


                                           <blockquote class="margin-top-40 margin-bottom-40">
                                    <p>exports.api=functions.https.onRequest(app);</p>
                                  </blockquote>
                                  <p>
                                    Finally, Deploy our project. Your endpoint of contact from the client app will be 
                                    BASE_URL/api/hello/ for this example. This is how you can easily implement a middleware in Firebase cloud functions. 

                                    Happy coding!
                                  </p>
                                    </div> </div>
                              </div>




                                  <!-- Post Author Bio Box Start -->
                                  <div class="about-author margin-top-70 margin-bottom-50">

                                    <div class="picture">
                                      <img src="../images/blog/author_new.jpg" class="img-responsive" alt="">
                                     </div>

                                    <div class="c-padding">
                                       <h3>Article By <a href="../index.html" target="_blank" data-toggle="tooltip" data-placement="top" title="Visit Athul's Website">Athul Antony</a></h3>
                                       <p>Liked my post or having doubts ? Mail me at <a href="mailto:someone@example.com?Subject=TechEOS|1615" target="_top"> athul@entri.me </a></p>
                                      </div>
                                    </div>
                                    <!-- Post Author Bio Box End -->






                       <!-- Footer Start -->
                       <div class="col-md-12 page-body margin-top-50 footer">
                          <footer>
                          <ul class="menu-link">
                               <li><a href="../index.html">Home</a></li>
                               <li><a href="index.html">About</a></li>
                               <li><a href="../index.html">Work</a></li>
                               <li><a href="../index.html">Contact</a></li>
                            </ul>

                          <p>© Copyright 2017 TechEOS. All rights reserved</p>


						  <!-- UiPasta Credit Start -->
                          <div class="uipasta-credit">Design By <a href="http://www.uipasta.com" target="_blank">UiPasta</a></div>
                          <!-- UiPasta Credit End -->


                         </footer>
                       </div>
                       <!-- Footer End -->


                  </div>
                  <!-- Blog Post (Right Sidebar) End -->

            </div>
         </div>
      </div>


    <!-- Back to Top Start
    <a href="#" class="scroll-to-top"><i class="fa fa-long-arrow-up"></i></a>
     Back to Top End -->


    <!-- All Javascript Plugins  -->
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/plugin.js"></script>

    <!-- Main Javascript File  -->
    <script type="text/javascript" src="../js/scripts.js"></script>

    <!-- Syntax Highlighter Javascript File  -->
    <script type="text/javascript" src="../js/syntax/shCore.js"></script>
    <script type="text/javascript" src="../js/syntax/shBrushCss.js"></script>
    <script type="text/javascript" src="../js/syntax/shBrushJScript.js"></script>
    <script type="text/javascript" src="../js/syntax/shBrushPerl.js"></script>
    <script type="text/javascript" src="../js/syntax/shBrushPerl.js"></script>
    <script type="text/javascript" src="../js/syntax/shBrushPhp.js"></script>
    <script type="text/javascript" src="../js/syntax/shBrushPlain.js"></script>
    <script type="text/javascript" src="../js/syntax/shBrushPython.js"></script>
    <script type="text/javascript" src="../js/syntax/shBrushRuby.js"></script>
    <script type="text/javascript" src="../js/syntax/shBrushSql.js"></script>
    <script type="text/javascript" src="../js/syntax/shBrushVb.js"></script>
    <script type="text/javascript" src="../js/syntax/shBrushXml.js"></script>

	<!-- Syntax Highlighter Call Function -->
	<script type="text/javascript">
		SyntaxHighlighter.config.clipboardSwf = '../js/syntax/clipboard.swf';
		SyntaxHighlighter.all();
	</script>


   </body>
 </html>
